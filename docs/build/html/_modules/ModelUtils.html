
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>ModelUtils &#8212; HandWritten Digit Recognizer 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">HandWritten Digit Recognizer 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ModelUtils</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Mon Jun  8 10:26:57 2020</span>

<span class="sd">@author: befrenz</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># ===================================================( Loading Dependencies )===================================================</span>
<span class="c1"># Python Standard Libraries</span>
<span class="kn">import</span> <span class="nn">pickle</span>  <span class="c1"># for saving model</span>
<span class="kn">import</span> <span class="nn">math</span>  <span class="c1"># for using floor in creating minibatches</span>

<span class="c1"># core packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># loading custom model</span>
<span class="kn">from</span> <span class="nn">dataset</span> <span class="kn">import</span> <span class="n">label_description</span>
<span class="c1"># ===================================================( Loading Dependencies )===================================================</span>
<span class="c1"># Python Standard Libraries</span>
<span class="kn">import</span> <span class="nn">pickle</span>  <span class="c1"># for saving model</span>

<span class="kn">import</span> <span class="nn">math</span>  <span class="c1"># for using floor in creating minibatches</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># core packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># loading custom model</span>
<span class="kn">from</span> <span class="nn">dataset</span> <span class="kn">import</span> <span class="n">label_description</span>


<span class="c1"># Doc String is based on Google Style Python Docstrings: https://sphinxcontrib-napoleon.readthedocs.io/en/latest/index.html</span>
<span class="c1"># Doc Rendering:sphinxcontrib.napoleon </span>
<span class="c1"># ===================================================( Activation Functions )===================================================</span>
<div class="viewcode-block" id="relu"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.relu">[docs]</a><span class="k">def</span> <span class="nf">relu</span><span class="p">(</span><span class="n">Z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the ReLU activation of Z.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            Z (numpy.ndarray): Input Sum to a hidden unit, Z = W * X + b.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple: Following values</span>
<span class="sd">            - **A** (numpy.ndarray): Activation obtained by applying ReLU function to the sum. Size same as that of Z.</span>
<span class="sd">            - **cache** (numpy.ndarray): Value stored for use during backward propagation.</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; np.random.seed(1)</span>
<span class="sd">            &gt;&gt;&gt; Z = np.random.randn(1,6)</span>
<span class="sd">            &gt;&gt;&gt; A,cache = relu(Z)</span>
<span class="sd">            &gt;&gt;&gt; print(A)</span>
<span class="sd">            </span>
<span class="sd">            Output: </span>
<span class="sd">                [[1.62434536 0.     0.      0.      0.86540763 0.    ]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>

    <span class="n">cache</span> <span class="o">=</span> <span class="n">Z</span>  <span class="c1"># storing Z for later use during back propagation</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">cache</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="relu_grad"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.relu_grad">[docs]</a><span class="k">def</span> <span class="nf">relu_grad</span><span class="p">(</span><span class="n">dA</span><span class="p">,</span> <span class="n">cache</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the backward ReLU activation of dA.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            dA (numpy.ndarray): Gradient of activation of the previous layer.</span>
<span class="sd">            cache (numpy.ndarray): Value of Z stored during forward prop.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            numpy.ndarray: - **dZ**: array of gradient/derivative of the dA, Same size of dA.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; np.random.seed(1)</span>
<span class="sd">            &gt;&gt;&gt; dA = np.random.randn(1,6)</span>
<span class="sd">            &gt;&gt;&gt; cache = np.random.randn(1,6)</span>
<span class="sd">            &gt;&gt;&gt; dZ = relu_grad(dA,cache)</span>
<span class="sd">            &gt;&gt;&gt; print(dZ)</span>
<span class="sd">            </span>
<span class="sd">            Output:</span>
<span class="sd">                [[ 1.62434536  0.         -0.52817175  0.          0.86540763  0.        ]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">cache</span>
    <span class="n">dZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dA</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">dZ</span><span class="p">[</span><span class="n">Z</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># implementing integrated form of (gradiant of ReLU function * gradient of the loss function)</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">dZ</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dZ</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="softmax"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.softmax">[docs]</a><span class="k">def</span> <span class="nf">softmax</span><span class="p">(</span><span class="n">Z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the softmax activtion of Z.</span>
<span class="sd">        </span>
<span class="sd">        Argument:</span>
<span class="sd">            Z (numpy.ndarray): Input Sum to a hidden unit, Z = W * X + b.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple: Following Values</span>
<span class="sd">            - **A** (numpy.ndarray): Activation obtained by applying softmax function to the sum. Size same as that of Z.</span>
<span class="sd">            - **cache** (numpy.ndarray): Value stored for use during backward propagation.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; np.random.seed(2)</span>
<span class="sd">            &gt;&gt;&gt; Z= np.random.rand(7,1)</span>
<span class="sd">            &gt;&gt;&gt; A,cache = softmax(Z)</span>
<span class="sd">            &gt;&gt;&gt; print(A)</span>
<span class="sd">            </span>
<span class="sd">            Output:</span>
<span class="sd">                [[0.15477477]</span>
<span class="sd">                 [0.10270926]</span>
<span class="sd">                 [0.17340649]</span>
<span class="sd">                 [0.15467071]</span>
<span class="sd">                 [0.15237489]</span>
<span class="sd">                 [0.13925557]</span>
<span class="sd">                 [0.12280831]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="n">Z</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>  <span class="c1"># Avoiding underflow or overflow errors due to floating point instability in softmax</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="n">cache</span> <span class="o">=</span> <span class="n">Z</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">cache</span></div>


<span class="c1"># ===================================================( Creating Minibatches )====================================================</span>
<div class="viewcode-block" id="rand_mini_batches"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.rand_mini_batches">[docs]</a><span class="k">def</span> <span class="nf">rand_mini_batches</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">minibatch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the minibatches of X and corresponding Y of the given size.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            X (numpy.ndarray): Inputs Array.</span>
<span class="sd">            Y (numpy.ndarray): Output Labels.</span>
<span class="sd">            minibatch_size (int): Size of each minibatch.</span>
<span class="sd">            seed (int): Seed value for randomness.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            list: - **minibatches**: List of minibatches where each minibatch contains a minibatch of X and a minibatch of its corresponding Y.</span>
<span class="sd">            </span>
<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; X = np.random.randn(20,20)</span>
<span class="sd">            &gt;&gt;&gt; Y = np.random.rand(1,20)</span>
<span class="sd">            &gt;&gt;&gt; minibatches = rand_mini_batches(X,Y,minibatch_size = 4, seed = 2)</span>
<span class="sd">            &gt;&gt;&gt; print(minibatches[0][0].shape)</span>
<span class="sd">            &gt;&gt;&gt; print(minibatches[0][1].shape)</span>
<span class="sd">            </span>
<span class="sd">            Outputs:</span>
<span class="sd">                (20, 4)</span>
<span class="sd">                (1, 4)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>  <span class="c1"># varying the seed value so that the minibatchs become random in each epoch</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># number of training examples</span>
    <span class="n">minibatches</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Shuffle (X, Y)</span>
    <span class="n">permutation</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
    <span class="n">shuffled_X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">permutation</span><span class="p">]</span>
    <span class="n">shuffled_Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[:,</span> <span class="n">permutation</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">classes</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>

    <span class="c1"># Partition (shuffled_X, shuffled_Y) except for the last batch</span>
    <span class="n">num_complete_minibatches</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="n">minibatch_size</span><span class="p">)</span>  <span class="c1"># number of mini batches of size minibatch_size</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_complete_minibatches</span><span class="p">):</span>
        <span class="n">minibatch_X</span> <span class="o">=</span> <span class="n">shuffled_X</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">*</span> <span class="n">minibatch_size</span><span class="p">:</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">minibatch_size</span><span class="p">]</span>
        <span class="n">minibatch_Y</span> <span class="o">=</span> <span class="n">shuffled_Y</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">*</span> <span class="n">minibatch_size</span><span class="p">:</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">minibatch_size</span><span class="p">]</span>
        <span class="n">minibatch</span> <span class="o">=</span> <span class="p">(</span><span class="n">minibatch_X</span><span class="p">,</span> <span class="n">minibatch_Y</span><span class="p">)</span>
        <span class="n">minibatches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">minibatch</span><span class="p">)</span>

    <span class="c1"># Last batch (last minibatch &lt;= minibatch_size)</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">%</span> <span class="n">minibatch_size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">minibatch_X</span> <span class="o">=</span> <span class="n">shuffled_X</span><span class="p">[:,</span> <span class="n">num_complete_minibatches</span> <span class="o">*</span> <span class="n">minibatch_size</span><span class="p">:</span> <span class="n">m</span><span class="p">]</span>
        <span class="n">minibatch_Y</span> <span class="o">=</span> <span class="n">shuffled_Y</span><span class="p">[:,</span> <span class="n">num_complete_minibatches</span> <span class="o">*</span> <span class="n">minibatch_size</span><span class="p">:</span> <span class="n">m</span><span class="p">]</span>
        <span class="n">minibatch</span> <span class="o">=</span> <span class="p">(</span><span class="n">minibatch_X</span><span class="p">,</span> <span class="n">minibatch_Y</span><span class="p">)</span>
        <span class="n">minibatches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">minibatch</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">minibatches</span></div>


<span class="c1"># =====================================================( Time Conversion )======================================================</span>
<div class="viewcode-block" id="convert_time"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.convert_time">[docs]</a><span class="k">def</span> <span class="nf">convert_time</span><span class="p">(</span><span class="n">millisec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts time in miliseconf to higher values.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            milisec (int): Time in mili-seconds.</span>
<span class="sd">        </span>
<span class="sd">        Returns: </span>
<span class="sd">            tuple: Following values</span>
<span class="sd">            - **hours** (int):  Time in hours.</span>
<span class="sd">            - **mins** (int): Time in minutes.</span>
<span class="sd">            - **secs** (int):  Time in seconds.</span>
<span class="sd">            - **milisec** (int): Time in mili-seconds.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; hr,mins,sec,milisec = convert_time(millisec = 12450)</span>
<span class="sd">            &gt;&gt;&gt; print(&quot;%dhr %dmins %ds %dms&quot;%(hr,mins,sec,milisec))</span>
<span class="sd">            </span>
<span class="sd">            Outputs:</span>
<span class="sd">                0hr 0mins 12s 450ms</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># converting millisecons to hours, minutes, seconds and millisecond</span>
    <span class="c1"># the large numbers like 3.6e+6 comes from the relation between the time units</span>
    <span class="n">hours</span> <span class="o">=</span> <span class="n">millisec</span> <span class="o">//</span> <span class="mf">3.6e+6</span>
    <span class="n">mins</span> <span class="o">=</span> <span class="p">(</span><span class="n">millisec</span> <span class="o">%</span> <span class="mf">3.6e+6</span><span class="p">)</span> <span class="o">//</span> <span class="mi">60000</span>
    <span class="n">secs</span> <span class="o">=</span> <span class="p">((</span><span class="n">millisec</span> <span class="o">%</span> <span class="mf">3.6e+6</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60000</span><span class="p">)</span> <span class="o">//</span> <span class="mi">1000</span>
    <span class="n">millisec</span> <span class="o">=</span> <span class="p">((</span><span class="n">millisec</span> <span class="o">%</span> <span class="mf">3.6e+6</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60000</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1000</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">hours</span><span class="p">,</span> <span class="n">mins</span><span class="p">,</span> <span class="n">secs</span><span class="p">,</span> <span class="n">millisec</span><span class="p">)</span></div>


<span class="c1"># =======================================( Computing and Visualizing Evaluation Matrices )=======================================</span>
<div class="viewcode-block" id="confusion_matrix"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.confusion_matrix">[docs]</a><span class="k">def</span> <span class="nf">confusion_matrix</span><span class="p">(</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">prediction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a confusion matrix for a given output labels and prediction.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            y_orig (numpy.ndarray): Original Output Labels of shape(m,1); m = # of examples.</span>
<span class="sd">            prediction (numpy.ndarray): Predicted Labels of the dataset of shape (1,m).</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            numpy.ndarray:- **cm**: 2D confusion matrix.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; y = np.array([[1,2,3,3,0,2,5,4,2,2]]).reshape(10,1)</span>
<span class="sd">            &gt;&gt;&gt; pred = np.array([[2,2,1,3,0,2,5,4,2,2]]).reshape(1,10)</span>
<span class="sd">            &gt;&gt;&gt; prediction = {&quot;First Prediction&quot;:pred}</span>
<span class="sd">            &gt;&gt;&gt; cm_train = confusion_matrix(y,prediction)</span>
<span class="sd">            &gt;&gt;&gt; print(cm_train)</span>
<span class="sd">            </span>
<span class="sd">            Output:</span>
<span class="sd">                [[1 0 0 0 0 0]</span>
<span class="sd">                 [0 0 1 0 0 0]</span>
<span class="sd">                 [0 0 4 0 0 0]</span>
<span class="sd">                 [0 1 0 1 0 0]</span>
<span class="sd">                 [0 0 0 0 1 0]</span>
<span class="sd">                 [0 0 0 0 0 1]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_predict</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;First Prediction&quot;</span><span class="p">]</span>

    <span class="n">y_predicted</span> <span class="o">=</span> <span class="n">first_predict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">y_orig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_orig</span><span class="p">))</span>  <span class="c1"># or simply take classes = 10 for mnist or fashion-mnist</span>

    <span class="n">cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">classes</span><span class="p">,</span> <span class="n">classes</span><span class="p">))</span>  <span class="c1"># creating the matrix frame for the confusion matrix</span>

    <span class="c1"># generating the values in the confusion metrix</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="n">cm</span><span class="p">[</span><span class="n">y_orig</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_predicted</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">cm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="plot_confusion_matrix"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.plot_confusion_matrix">[docs]</a><span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">dataset_type</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s2">&quot;mnist&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots the Heatmap of the confusion matrix.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            cm (numpy.ndarray): 2D confusion matrix.</span>
<span class="sd">            dataset_type (str): Type of dataset. May be training or dev or test.</span>
<span class="sd">            dataset (str): Dataset used to train the model. Default to &#39;mnist&#39;</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; plot_confusion_matrix(cm, dataset_type)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># plotting the metrix</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;GnBu&quot;</span><span class="p">)</span>  <span class="c1"># RdYlGn, PiYG, Accent,Blues,viridis, YlGnBu</span>

    <span class="c1"># plotting the color bar of the plot size</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.045</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_type</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">visual_title</span> <span class="o">=</span> <span class="s2">&quot;Confusion Matrix for </span><span class="si">%s</span><span class="s2"> Set &quot;</span> <span class="o">%</span> <span class="n">dataset_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Dataset set must be training or dev or test set&quot;</span><span class="p">)</span>

    <span class="c1"># getting the label description</span>
    <span class="n">label_desc</span> <span class="o">=</span> <span class="n">label_description</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="p">[</span><span class="n">label_desc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>

    <span class="c1"># annotating the plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">visual_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Predicted&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Expexted&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>

    <span class="c1"># setting horizontal axes labeling to top.</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

    <span class="c1"># creating the threshold for color change in the visualization</span>
    <span class="n">thres</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="c1"># calculating the percentage of the total image denoted by the cell</span>
            <span class="n">per</span> <span class="o">=</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="c1"># putting up the text inside the plot cells</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="se">\n</span><span class="si">%.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">per</span><span class="p">),</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span> <span class="k">if</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">thres</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="precision"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.precision">[docs]</a><span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">cm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the precision for the prediction of an individual label.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            label (int): unique labels (each class).</span>
<span class="sd">            cm (numpy.ndarray): 2D confusion matrix.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            numpy.float64: - **prec**: Precision for the given label.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; cm = [[1 0 0 0 0 0]</span>
<span class="sd">            ...       [0 0 1 0 0 0]</span>
<span class="sd">            ...       [0 0 4 0 0 0]</span>
<span class="sd">            ...       [0 1 0 1 0 0]</span>
<span class="sd">            ...       [0 0 0 0 1 0]</span>
<span class="sd">            ...       [0 0 0 0 0 1]]</span>
<span class="sd">            &gt;&gt;&gt; label = 2</span>
<span class="sd">            &gt;&gt;&gt; prec = precision(label, cm)</span>
<span class="sd">            &gt;&gt;&gt; print(prec)</span>
<span class="sd">            </span>
<span class="sd">            Output:</span>
<span class="sd">                0.8</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">cm</span><span class="p">[:,</span> <span class="n">label</span><span class="p">]</span>  <span class="c1"># selecting the True Positive and false positive values</span>
    <span class="n">prec</span> <span class="o">=</span> <span class="n">cm</span><span class="p">[</span><span class="n">label</span><span class="p">,</span> <span class="n">label</span><span class="p">]</span> <span class="o">/</span> <span class="n">col</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># perc = TP / (TP + FP)</span>

    <span class="k">return</span> <span class="n">prec</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="recall"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.recall">[docs]</a><span class="k">def</span> <span class="nf">recall</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">cm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the recall for the prediction of an individual label.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            label (int): unique labels (each class).</span>
<span class="sd">            cm (numpy.ndarray): 2D confusion matrix.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            numpy.float64: - **rec**: Recall for the given label.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; cm = [[1 0 0 0 0 0]</span>
<span class="sd">            ...       [0 0 1 0 0 0]</span>
<span class="sd">            ...       [0 0 4 0 0 0]</span>
<span class="sd">            ...       [0 1 0 1 0 0]</span>
<span class="sd">            ...       [0 0 0 0 1 0]</span>
<span class="sd">            ...       [0 0 0 0 0 1]]</span>
<span class="sd">            &gt;&gt;&gt; label = 2</span>
<span class="sd">            &gt;&gt;&gt; rec = recall(label, cm)</span>
<span class="sd">            &gt;&gt;&gt; print(rec)</span>
<span class="sd">            </span>
<span class="sd">            Output:</span>
<span class="sd">                1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">cm</span><span class="p">[</span><span class="n">label</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># selecting the True Positive and false Negative values</span>
    <span class="n">rec</span> <span class="o">=</span> <span class="n">cm</span><span class="p">[</span><span class="n">label</span><span class="p">,</span> <span class="n">label</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># rec = TP / (TP + FN)</span>

    <span class="k">return</span> <span class="n">rec</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="f1_score"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.f1_score">[docs]</a><span class="k">def</span> <span class="nf">f1_score</span><span class="p">(</span><span class="n">prec</span><span class="p">,</span> <span class="n">rec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the f1-score for the prediction of an individual label.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            prec (numpy.float64): precision for a label.</span>
<span class="sd">            rec (numpy.float64): recall for a label.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            numpy.float64: - **f1**: f1-score for the precision and recall.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; prec = 0.8</span>
<span class="sd">            &gt;&gt;&gt; rec = 1.0</span>
<span class="sd">            &gt;&gt;&gt; f1 = f1_score(prec,rec)</span>
<span class="sd">            &gt;&gt;&gt; print(f1)</span>
<span class="sd">            </span>
<span class="sd">            Output:</span>
<span class="sd">                0.888888888888889</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">prec</span> <span class="o">*</span> <span class="n">rec</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">prec</span> <span class="o">+</span> <span class="n">rec</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">f1</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="macro_precision_average"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.macro_precision_average">[docs]</a><span class="k">def</span> <span class="nf">macro_precision_average</span><span class="p">(</span><span class="n">precs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the macro average of the precisions for the prediction of all the label.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            precs (list): lists of precisions of type numpy.float64.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            numpy.float64: - **prec_mac_avg**: macro average of the precisions.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; avg_precision = macro_precision_average(prec)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">precs</span><span class="p">)</span>
    <span class="n">prec_mac_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">precs</span><span class="p">)</span> <span class="o">/</span> <span class="n">count</span>

    <span class="k">return</span> <span class="n">prec_mac_avg</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="macro_recall_average"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.macro_recall_average">[docs]</a><span class="k">def</span> <span class="nf">macro_recall_average</span><span class="p">(</span><span class="n">recs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the macro average of the recall for the prediction of all the label.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            recs (list): lists of recalls of type numpy.float64.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            numpy.float64: - **rec_mac_avg**: macro average of the recalls.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; avg_recall = macro_recall_average(rec)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span>
    <span class="n">rec_mac_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span> <span class="o">/</span> <span class="n">count</span>

    <span class="k">return</span> <span class="n">rec_mac_avg</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="macro_f1_score"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.macro_f1_score">[docs]</a><span class="k">def</span> <span class="nf">macro_f1_score</span><span class="p">(</span><span class="n">f1s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the macro average of the f1-score for the prediction of all the label.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            f1s (list): lists of f1-scores of type numpy.float64.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            numpy.float64: - **f1_mac_avg**: macro average of the f1-scores.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; avg_f1 = macro_f1_score(f1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f1s</span><span class="p">)</span>
    <span class="n">f1_mac_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f1s</span><span class="p">)</span> <span class="o">/</span> <span class="n">count</span>

    <span class="k">return</span> <span class="n">f1_mac_avg</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="accuracy"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.accuracy">[docs]</a><span class="k">def</span> <span class="nf">accuracy</span><span class="p">(</span><span class="n">cm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the accuracy of the prediction.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            cm (numpy.ndarray): 2D confusion matrix.</span>

<span class="sd">        Returns:</span>
<span class="sd">            numpy.float64: - **acc**: Accuracy of the prediction.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; cm = [[1 0 0 0 0 0]</span>
<span class="sd">            ...       [0 0 1 0 0 0]</span>
<span class="sd">            ...       [0 0 4 0 0 0]</span>
<span class="sd">            ...       [0 1 0 1 0 0]</span>
<span class="sd">            ...       [0 0 0 0 1 0]</span>
<span class="sd">            ...       [0 0 0 0 0 1]]</span>
<span class="sd">            &gt;&gt;&gt; acc = accuracy(cm)</span>
<span class="sd">            </span>
<span class="sd">            Outputs:</span>
<span class="sd">                0.8</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">diagonal_sum</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span>  <span class="c1"># getting the total truely classified images</span>
    <span class="n">sum_of_all_elements</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># getting the total number of images</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">diagonal_sum</span> <span class="o">/</span> <span class="n">sum_of_all_elements</span>

    <span class="k">return</span> <span class="n">acc</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="model_metrics"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.model_metrics">[docs]</a><span class="k">def</span> <span class="nf">model_metrics</span><span class="p">(</span><span class="n">cm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the metrices and macro metrices for the evaluation of the model.</span>
<span class="sd">        Metrices includes: Precision, Recall and F1-score</span>
<span class="sd">        Macro Metrices includes: Macro Precision Average, Macro Recall Average and Macro F1-score Average</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            cm (numpy.ndarray): 2D confusion matrix.</span>

<span class="sd">        Returns: tuple: Following Values</span>
<span class="sd">            - **metrices** (dict): Model Metrices including list of Precision, Recall and F1-score.</span>
<span class="sd">            - **macro_metrices** (dict): Model Macro metrices including Macro Precision Average, Macro Recall Average and Macro F1-score Average.</span>
<span class="sd">            - **acc** (numpy.float64): Accuracy of the prediction.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; metrics, macro_metrics, acc = model_metrics(cm)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">precs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">recs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">f1s</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">macro_metrics</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># calculating precision, recall and f1-score for all the classes or labels</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">precs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">precision</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">cm</span><span class="p">))</span>
        <span class="n">recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recall</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">cm</span><span class="p">))</span>
        <span class="n">f1s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f1_score</span><span class="p">(</span><span class="n">precs</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">recs</span><span class="p">[</span><span class="n">label</span><span class="p">]))</span>

    <span class="c1"># calculating the macro average metrices</span>
    <span class="n">avg_precision</span> <span class="o">=</span> <span class="n">macro_precision_average</span><span class="p">(</span><span class="n">precs</span><span class="p">)</span>  <span class="c1"># calculating the macro metrices</span>
    <span class="n">avg_recall</span> <span class="o">=</span> <span class="n">macro_recall_average</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span>
    <span class="n">avg_f1</span> <span class="o">=</span> <span class="n">macro_f1_score</span><span class="p">(</span><span class="n">f1s</span><span class="p">)</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>

    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Precision&quot;</span><span class="p">:</span> <span class="n">precs</span><span class="p">,</span>
               <span class="s2">&quot;Recall&quot;</span><span class="p">:</span> <span class="n">recs</span><span class="p">,</span>
               <span class="s2">&quot;F1-Score&quot;</span><span class="p">:</span> <span class="n">f1s</span><span class="p">}</span>
    <span class="n">macro_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Precision&quot;</span><span class="p">:</span> <span class="n">avg_precision</span><span class="p">,</span>
                     <span class="s2">&quot;Recall&quot;</span><span class="p">:</span> <span class="n">avg_recall</span><span class="p">,</span>
                     <span class="s2">&quot;F1-Score&quot;</span><span class="p">:</span> <span class="n">avg_f1</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">macro_metrics</span><span class="p">,</span> <span class="n">acc</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="metric_summary"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.metric_summary">[docs]</a><span class="k">def</span> <span class="nf">metric_summary</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">macro_metrics</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays the metric summary after evaluation.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            metrices (dict): Model Metrices including list of Precision, Recall and F1-score.</span>
<span class="sd">            macro_metrices (dict): Model Macro metrices including Macro Precision Average, Macro Recall Average and Macro F1-score Average.</span>
<span class="sd">            accuracy (numpy.float64): Accuracy of the prediction.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; metric_summary(metrics, macro_metrics, acc)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;+===============+===============+===============+===============+&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;| Label </span><span class="se">\t</span><span class="s2">| Precision </span><span class="se">\t</span><span class="s2">| Recall </span><span class="se">\t</span><span class="s2">| F1 Score </span><span class="se">\t</span><span class="s2">|&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;+===============+===============+===============+===============+&quot;</span><span class="p">)</span>
    <span class="n">prec</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Precision&quot;</span><span class="p">]</span>
    <span class="n">rec</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Recall&quot;</span><span class="p">]</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;F1-Score&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prec</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;| </span><span class="si">%d</span><span class="s2"> </span><span class="se">\t\t</span><span class="s2">|  </span><span class="si">%.5f</span><span class="s2"> </span><span class="se">\t</span><span class="s2">|  </span><span class="si">%.5f</span><span class="s2"> </span><span class="se">\t</span><span class="s2">|  </span><span class="si">%.5f</span><span class="s2"> </span><span class="se">\t</span><span class="s2">|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">prec</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">rec</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">f1</span><span class="p">[</span><span class="n">label</span><span class="p">]))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;+===============+===============+===============+===============+&quot;</span><span class="p">)</span>

    <span class="n">avg_precision</span> <span class="o">=</span> <span class="n">macro_metrics</span><span class="p">[</span><span class="s2">&quot;Precision&quot;</span><span class="p">]</span>
    <span class="n">avg_recall</span> <span class="o">=</span> <span class="n">macro_metrics</span><span class="p">[</span><span class="s2">&quot;Recall&quot;</span><span class="p">]</span>
    <span class="n">avg_f1</span> <span class="o">=</span> <span class="n">macro_metrics</span><span class="p">[</span><span class="s2">&quot;F1-Score&quot;</span><span class="p">]</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;| Macro Avg </span><span class="se">\t</span><span class="s2">|  </span><span class="si">%.5f</span><span class="s2"> </span><span class="se">\t</span><span class="s2">|  </span><span class="si">%.5f</span><span class="s2"> </span><span class="se">\t</span><span class="s2">|  </span><span class="si">%.5f</span><span class="s2"> </span><span class="se">\t</span><span class="s2">|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">avg_precision</span><span class="p">,</span> <span class="n">avg_recall</span><span class="p">,</span> <span class="n">avg_f1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;+===============+===============+===============+===============+&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Accuracy </span><span class="se">\t\t</span><span class="s2">  </span><span class="si">%.5f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">acc</span><span class="p">))</span></div>


<span class="c1"># =========================================( Visualizing Predictions and acc-loss plots )========================================</span>
<div class="viewcode-block" id="visualize_training_results"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.visualize_training_results">[docs]</a><span class="k">def</span> <span class="nf">visualize_training_results</span><span class="p">(</span><span class="n">train_accs</span><span class="p">,</span> <span class="n">val_accs</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">,</span> <span class="n">val_loss</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Visualize the traininig accuracy and loss, validation accuracy and loss over the training time.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            train_accs (list): training accuracies obtained in all the minibatches in all epochs</span>
<span class="sd">            val_accs (list): validation accuracies obtained in all the minibatches in all epochs</span>
<span class="sd">            train_loss (list): training losses obtained in all the minibatches in all epochs</span>
<span class="sd">            val_loss (list): validation losses obtained in all the minibatches in all epochs</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; visualize_training_results(train_accs, val_accs, train_losses, val_losses)    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># creating subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># plotting the loss</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">train_loss</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Training Loss&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">val_loss</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation Loss&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>  <span class="c1"># setting up legend location to upper right corner of the plot</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Training and Validation Loss &quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;No. of Epochs&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Loss&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># plotting the accuracy</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">train_accs</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Training Accuracy&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">val_accs</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation Accuracy&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>  <span class="c1"># setting up legend location to lower right corner of the plot</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Accuracy &quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;No. of Epochs&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="visualize_prediction"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.visualize_prediction">[docs]</a><span class="k">def</span> <span class="nf">visualize_prediction</span><span class="p">(</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y_orig</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">dataset_type</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s2">&quot;mnist&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays 10 random images along with their true and predicted labels. </span>
<span class="sd">        Both initial prediction and second guess are displayed.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            x_orig (numpy.ndarray): original input data.</span>
<span class="sd">            y_orig (numpy.ndarray): original output labels.</span>
<span class="sd">            prediction (numpy.ndarray): predictions obtained after training the model.</span>
<span class="sd">            dataset_type (str): Type of dataset. May be training, dev  or test.</span>
<span class="sd">            dataset (str): Dataset used to train the model. Default to &#39;mnist&#39;</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; visualize_prediction(x_orig, y_orig.T, prediction, dataset_type = &quot;training&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_type</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">visual_title</span> <span class="o">=</span> <span class="s2">&quot;Sample </span><span class="si">%s</span><span class="s2"> Data Set &quot;</span> <span class="o">%</span> <span class="n">dataset_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Dataset set must be training or dev or test set&quot;</span><span class="p">)</span>

    <span class="c1"># getting the random index of 8 images to plot</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

    <span class="c1"># getting the label description</span>
    <span class="n">label_desc</span> <span class="o">=</span> <span class="n">label_description</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

    <span class="c1"># plotting the images along with the predictions</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">visual_title</span><span class="p">)</span>

    <span class="n">first_lbl</span><span class="p">,</span> <span class="n">first_prob</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;First Prediction&quot;</span><span class="p">]</span>
    <span class="n">sec_lbl</span><span class="p">,</span> <span class="n">sec_prob</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;Second Prediction&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">x_orig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;True Label: </span><span class="si">%d</span><span class="s2"> | </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">y_orig</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">label_desc</span><span class="p">[</span><span class="n">y_orig</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Prediction: </span><span class="si">%d</span><span class="s2"> | With Prob: </span><span class="si">%.4f</span><span class="s2"> </span><span class="se">\n</span><span class="s2">2nd Guess: </span><span class="si">%d</span><span class="s2"> | With Prob: </span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">first_lbl</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">first_prob</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">sec_lbl</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">sec_prob</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="visualize_mislabelled_images"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.visualize_mislabelled_images">[docs]</a><span class="k">def</span> <span class="nf">visualize_mislabelled_images</span><span class="p">(</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y_orig</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">dataset_type</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s2">&quot;mnist&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays 10 wrongly predicted images along with their true and predicted labels. </span>
<span class="sd">        Both initial prediction and second guess are displayed.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            x_orig (numpy.ndarray): original input data.</span>
<span class="sd">            y_orig (numpy.ndarray): original output labels.</span>
<span class="sd">            prediction (numpy.ndarray): predictions obtained after training the model.</span>
<span class="sd">            dataset_type (str): Type of dataset. May be training, dev  or test.</span>
<span class="sd">            dataset (str): Dataset used to train the model. Default to &#39;mnist&#39;</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; visualize_mislabelled_images(x_orig, y_orig.T, prediction, dataset_type = &quot;training&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_lbl</span><span class="p">,</span> <span class="n">first_prob</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;First Prediction&quot;</span><span class="p">]</span>
    <span class="n">sec_lbl</span><span class="p">,</span> <span class="n">sec_prob</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;Second Prediction&quot;</span><span class="p">]</span>

    <span class="n">true_prediction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">first_lbl</span><span class="p">,</span> <span class="n">y_orig</span><span class="p">)</span>
    <span class="n">mislabelled_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">true_prediction</span> <span class="o">==</span> <span class="kc">False</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total Mislabelled Images: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mislabelled_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_type</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">visual_title</span> <span class="o">=</span> <span class="s2">&quot;Sample Mislabelled </span><span class="si">%s</span><span class="s2"> Set Images &quot;</span> <span class="o">%</span> <span class="n">dataset_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Dataset set must be training or dev or test set&quot;</span><span class="p">)</span>

    <span class="c1"># getting the label description</span>
    <span class="n">label_desc</span> <span class="o">=</span> <span class="n">label_description</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

    <span class="c1"># plotting the mislabelled images along with the predictions</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">visual_title</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">mislabelled_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">x_orig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;True Label: </span><span class="si">%d</span><span class="s2"> | </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">y_orig</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">label_desc</span><span class="p">[</span><span class="n">y_orig</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Prediction: </span><span class="si">%d</span><span class="s2"> | With Prob: </span><span class="si">%.4f</span><span class="s2"> </span><span class="se">\n</span><span class="s2">2nd Guess: </span><span class="si">%d</span><span class="s2"> | With Prob: </span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">first_lbl</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">first_prob</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">sec_lbl</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">sec_prob</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span></div>


<span class="c1"># =================================================( Saving and Loading Model )==================================================</span>
<div class="viewcode-block" id="save_model"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.save_model">[docs]</a><span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Saves the parameters of the trained model into a pickle file.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            file_name (str): name of the file to be saved.</span>
<span class="sd">            model (dict): trained model to be saved in the file. Consists of Parameters and activations </span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; save_model(file_name = path + fname, model)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span></div>


<span class="c1"># ------------------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="load_model"><a class="viewcode-back" href="../ModelUtils.html#ModelUtils.load_model">[docs]</a><span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load the saved model from a pickle file</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            file_name (str): name of the file to be loaded from</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            model (dict): trained model to be saved in the file. Consists of Parameters and activations </span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; model = load_model(file_name = path + fname)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">model</span>

    <span class="k">except</span><span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>

<span class="c1"># ==============================================================================================================================</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">HandWritten Digit Recognizer 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Sameer Kattel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.4.
    </div>
  </body>
</html>